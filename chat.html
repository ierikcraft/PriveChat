<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PriveChat - Chat</title>
<style>
  body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5;display:flex;flex-direction:column;height:100vh;}
  .chat-container{flex:1;display:flex;flex-direction:column;padding:10px;overflow-y:auto;}
  .message{max-width:70%;padding:10px 14px;margin:5px 0;border-radius:15px;line-height:1.4;}
  .sent{background:#0084ff;color:white;align-self:flex-end;border-bottom-right-radius:3px;}
  .received{background:#e4e6eb;color:black;align-self:flex-start;border-bottom-left-radius:3px;}
  .input-container{display:flex;padding:10px;background:white;border-top:1px solid #ddd;}
  .input-container input{flex:1;padding:10px;border:1px solid #ccc;border-radius:20px;outline:none;}
  .input-container button{margin-left:10px;padding:10px 16px;border:none;background:#0084ff;color:white;border-radius:20px;cursor:pointer;}
</style>
</head>
<body>
<div class="chat-container" id="chat"></div>
<div class="input-container">
  <input type="text" id="messageInput" placeholder="EscribÃ­ un mensaje...">
  <button onclick="sendMessage()">Enviar</button>
</div>

<script>
const username = localStorage.getItem('PriveChatUser') || 'Anonimo';
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxCkAraLG-B2aFoNVmoPkNHdVr7VQir_nAQPDi7o6R0yHiqWhgWv4VTtTk1IGtex30k-A/exec';
const chat = document.getElementById('chat');

async function loadMessages(){
  try{
    const res = await fetch(SHEET_URL);
    const data = await res.json();
    chat.innerHTML = '';
    data.forEach(msg=>{
      const div = document.createElement('div');
      div.classList.add('message', msg.user===username ? 'sent' : 'received');
      div.textContent = `${msg.user}: ${msg.text}`;
      chat.appendChild(div);
    });
    chat.scrollTop = chat.scrollHeight;
  }catch(e){
    console.error('Error cargando mensajes', e);
  }
}

// Enviar mensaje a Google Sheets
async function sendMessage(){
  const input = document.getElementById('messageInput');
  const text = input.value.trim();
  if(!text) return;

  try{
    await fetch(SHEET_URL,{
      method:'POST',
      body: JSON.stringify({
        user: username,
        text: text,
        timestamp: new Date().toISOString()
      })
    });
    input.value='';
    loadMessages();
  }catch(e){console.error('Error enviando mensaje', e);}
}

// Recargar mensajes cada 3 segundos
setInterval(loadMessages,3000);
loadMessages();
</script>
</body>
</html>
